<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="delegate-ch" content="sec-ch-ua https://guirmannurcence.com; sec-ch-ua-mobile https://guirmannurcence.com; sec-ch-ua-arch https://guirmannurcence.com; sec-ch-ua-model https://guirmannurcence.com; sec-ch-ua-platform https://guirmannurcence.com; sec-ch-ua-platform-version https://guirmannurcence.com; sec-ch-ua-bitness https://guirmannurcence.com; sec-ch-ua-full-version-list https://guirmannurcence.com; sec-ch-ua-full-version https://guirmannurcence.com">
    <style>
        .dtpcnt { opacity: 0; }
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        pre { white-space: pre-wrap; font-size: 14px; background-color: #f8f8f8; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        #output { margin-top: 20px; }
    </style>
    <script>
        (function(c,d,f,h,t,b,n,u,k,l,m,e,p,v,q){function r(a){var c=d.cookie.match(new RegExp("(^| )"+a+"=([^;]+)"));return c?c.pop():f.getItem(a+"-expires")&&+f.getItem(a+"-expires")>(new Date).getTime()?f.getItem(a):null}q="https:"===c.location.protocol?"secure; ":"";c[b]||(c[b]=function(a){c[b].state.callbackQueue.push(a)},c[b].state={callbackQueue:[]},c[b].registerConversion=function(a){c[b].state.callbackQueue.push(a)},function(){(m=/[?&]cpid(=([^&#]*)|&|#|$)/.exec(c.location.href))&&m[2]&&(e=m[2],
p=r("vl-"+e));var a=r("vl-cid"),b;"savedCid"!==u||!a||e&&"undefined"!==typeof e||(b=a);k=d.createElement("script");l=d.scripts[0];k.src=n+(-1===n.indexOf("?")?"?":"&")+"oref="+h(d.referrer)+"&ourl="+h(location[t])+"&opt="+h(d.title)+"&vtm="+(new Date).getTime()+(b?"&cid="+b:"")+(p?"&uw=no":"");l.parentNode.insertBefore(k,l);if(e){a="vl-"+e;b=q;var g=new Date;g.setTime(g.getTime()+864E5);d.cookie=a+"=1; "+b+"samesite=Strict; expires="+g.toGMTString()+"; path=/";f.setItem(a,"1");f.setItem(a+"-expires",
g.getTime())}}())})(window,document,localStorage,encodeURIComponent,"href","dtpCallback","https://guirmannurcence.com/d/.js","savedCid");
    </script>
    <noscript><link href="https://guirmannurcence.com/d/.js?noscript=true&ourl=" rel="stylesheet"/></noscript>
    <title>Офферы</title>
</head>
<body>
    <h1>Доступные офферы</h1>
    <button id="show-offers">Показать офферы</button>
    <div id="output"></div>
    <script>
        dtpCallback((params) => {
            const outputDiv = document.getElementById('output');
            const showButton = document.getElementById('show-offers');
            const maxOffers = 50;

            // Проверяем доступность localStorage
            let localStorageStatus = 'Доступно';
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
            } catch (e) {
                localStorageStatus = 'Недоступно: ' + e.message;
            }

            showButton.addEventListener('click', () => {
                console.log('Params:', params);
                console.log('Tokens:', dtpCallback.getTokens());

                // Формируем текстовый вывод
                let output = 'Параметры кампании:\n';
                output += JSON.stringify({
                    'flow.id': params['flow.id'],
                    'lander.id': params['lander.id'],
                    'clickid': params['clickid'],
                    'campaign.id': params['campaign.id'],
                    'trafficsource.id': params['trafficsource.id'],
                    'headline': params['headline'],
                    'clickParams': params['clickParams']
                }, null, 2) + '\n\n';

                output += 'Токены посетителя:\n';
                output += JSON.stringify(dtpCallback.getTokens(), null, 2) + '\n\n';

                output += 'Офферы:\n';
                let hasValidOffers = false;
                for (let index = 0; index < maxOffers; index++) {
                    if (params.links && params.links[index] && params.links[index].redirectUrl) {
                        const redirectUrl = params.links[index].redirectUrl;
                        const beaconUrl = params.links[index].beaconUrl || 'null';
                        const urlParams = {};
                        try {
                            const url = new URL(redirectUrl);
                            for (let [key, value] of url.searchParams.entries()) {
                                urlParams[key] = value;
                            }
                        } catch (e) {
                            console.error(`Ошибка обработки URL для оффера ${index}:`, e);
                        }

                        output += `Оффер ${index === 0 ? 'default' : index}:\n`;
                        output += `  redirectUrl: ${redirectUrl}\n`;
                        output += `  beaconUrl: ${beaconUrl}\n`;
                        output += `  Параметры оффера: ${JSON.stringify(urlParams, null, 2)}\n\n`;
                        hasValidOffers = true;
                    }
                }

                if (!hasValidOffers) {
                    output += 'Нет доступных офферов. Проверьте конфигурацию в Voluum или наличие валидных redirectUrl в ответе трекера.\n';
                }

                output += `Статус localStorage: ${localStorageStatus}\n`;

                // Выводим текст в div
                const pre = document.createElement('pre');
                pre.textContent = output;
                outputDiv.innerHTML = '';
                outputDiv.appendChild(pre);
            });
        });
    </script>
</body>
</html>
